<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Clay Knockout: Prince vs Tyson</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#2b2b2b">
<link rel="manifest" href="manifest.json">
<style>
body { margin:0; background:#2b2b2b; touch-action:manipulation; font-family:Arial,sans-serif; }
canvas { display:block; margin:auto; background:radial-gradient(#444,#111); }
#ui { position:absolute; top:10px; width:100%; text-align:center; color:white; }
button { background:#c0392b; color:white; border:none; padding:10px 16px; border-radius:20px; font-size:16px; }
</style>
</head>
<body>
<div id="ui"><button id="special">SPECIAL</button></div>
<canvas id="game"></canvas>

<script>
// --- PWA Service Worker ---
if ("serviceWorker" in navigator) navigator.serviceWorker.register("sw.js");

// --- Canvas Setup ---
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
function resizeCanvas(){ canvas.width=window.innerWidth; canvas.height=window.innerHeight; }
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

// --- Game State ---
let player={x:canvas.width*0.25,y:canvas.height*0.7,hp:100,meter:0,hit:false,punch:false};
let enemy={x:canvas.width*0.75,y:canvas.height*0.7,hp:100,hit:false,punch:false};
const stageLeft=50, stageRight=canvas.width-50;

// --- Background: Crowd + Clay Ring ---
function drawBackground(){
  // Crowd silhouettes
  for(let i=0;i<canvas.width;i+=30){
    ctx.fillStyle=`rgba(0,0,0,${0.1+Math.random()*0.2})`;
    ctx.beginPath();
    ctx.arc(i,canvas.height*0.6+Math.random()*20,10,0,Math.PI*2);
    ctx.fill();
  }

  // Clay ring floor
  let ringGrad=ctx.createRadialGradient(canvas.width/2,canvas.height*0.7,50,canvas.width/2,canvas.height*0.7,canvas.width/2);
  ringGrad.addColorStop(0,"#7a5d3b");
  ringGrad.addColorStop(1,"#3e2f1c");
  ctx.fillStyle=ringGrad;
  ctx.beginPath();
  ctx.ellipse(canvas.width/2,canvas.height*0.7,canvas.width*0.4,100,0,0,Math.PI*2);
  ctx.fill();

  // Ring ropes
  ctx.strokeStyle="#d4af37"; ctx.lineWidth=4;
  for(let j=0;j<3;j++){
    ctx.beginPath();
    ctx.ellipse(canvas.width/2,canvas.height*0.7-20+j*20,canvas.width*0.4,100,0,0,Math.PI*2);
    ctx.stroke();
  }
}

// --- Clay Fighter Drawing ---
function drawFighter(f,char){
  ctx.save();
  ctx.translate(f.x,f.y);

  // Stop-motion jiggle
  let jig=[(Math.random()-0.5)*2,(Math.random()-0.5)*2];
  ctx.translate(...jig);

  // Squash/stretch on hit
  let scaleY=f.hit?1.2:1; ctx.scale(1,scaleY);

  // Shadow under fighter
  let shadowGrad=ctx.createRadialGradient(0,35,5,0,35,20);
  shadowGrad.addColorStop(0,"rgba(0,0,0,0.4)");
  shadowGrad.addColorStop(1,"rgba(0,0,0,0)");
  ctx.fillStyle=shadowGrad;
  ctx.beginPath(); ctx.ellipse(0,35,20,10,0,0,Math.PI*2); ctx.fill();

  // Helper: Draw clay limb/torso with highlights
  function clayPart(x,y,rX,rY,base,highlight){
    let grad=ctx.createRadialGradient(x,y-rY/2,rY/5,x,y,rY*1.1);
    grad.addColorStop(0,highlight); grad.addColorStop(1,base);
    ctx.fillStyle=grad;
    ctx.beginPath(); ctx.ellipse(x,y,rX,rY,0,0,Math.PI*2); ctx.fill();
  }

  // --- Prince ---
  if(char==="prince"){
    // Legs (tapered clay tubes)
    clayPart(-12,30,8,18,"#6a0dad","#9b4ef7");
    clayPart(12,30,8,18,"#6a0dad","#9b4ef7");

    // Torso (layered clay)
    clayPart(0,5,25,35,"#55228b","#8a5de9");
    clayPart(0,-5,20,10,"#8a2be2","#b366ff"); // chest layer

    // Arms (bent for punch)
    clayPart(-30,-5,8,25,"#6a0dad","#9b4ef7");
    clayPart(30,-5,8,25,"#6a0dad","#9b4ef7");

    // Head
    clayPart(0,-25,15,20,"#f1c27d","#ffeebb");

    // Hair
    clayPart(0,-40,10,10,"#4b0082","#7f00fc");

    // Facial features
    ctx.fillStyle="#000";
    ctx.beginPath(); ctx.arc(-5,-27,2,0,Math.PI*2); ctx.arc(5,-27,2,0,Math.PI*2); ctx.fill(); // eyes
    ctx.strokeStyle="#000"; ctx.lineWidth=1;
    ctx.beginPath(); ctx.arc(0,-20,4,0,Math.PI); ctx.stroke(); // mouth
  }

  // --- Mike Tyson ---
  if(char==="tyson"){
    // Legs
    clayPart(-12,30,10,20,"#111","#333");
    clayPart(12,30,10,20,"#111","#333");

    // Torso
    clayPart(0,5,28,36,"#f1c27d","#ffeebb");
    clayPart(0,-5,24,12,"#cfa27d","#ffeebb"); // layered torso

    // Arms
    clayPart(-30,-5,10,25,"#f1c27d","#ffeebb");
    clayPart(30,-5,10,25,"#f1c27d","#ffeebb");

    // Boxing gloves
    clayPart(-30,10,10,10,"#ff5555","#ff8888");
    clayPart(30,10,10,"#ff5555","#ff8888");

    // Head
    clayPart(0,-25,15,20,"#f1c27d","#ffeebb");

    // Facial tattoo
    ctx.strokeStyle="#000"; ctx.lineWidth=2;
    ctx.beginPath(); ctx.moveTo(4,-23); ctx.quadraticCurveTo(8,-28,5,-18); ctx.stroke();

    // Eyes
    ctx.fillStyle="#000"; ctx.beginPath(); ctx.arc(-5,-27,2,0,Math.PI*2); ctx.arc(5,-27,2,0,Math.PI*2); ctx.fill();
    ctx.strokeStyle="#000"; ctx.lineWidth=1;
    ctx.beginPath(); ctx.arc(0,-20,4,0,Math.PI); ctx.stroke(); // mouth
  }

  ctx.restore();
}

// --- Draw UI ---
function drawUI(){
  ctx.fillStyle="red"; ctx.fillRect(20,20,player.hp*2,10);
  ctx.fillRect(canvas.width-220,20,enemy.hp*2,10);
  ctx.fillStyle="yellow"; ctx.fillRect(20,40,player.meter*2,6);
}

// --- Movement & Punch ---
let moveLeft=false, moveRight=false;
function punch(target,fighter,dmg){ target.hp-=dmg; fighter.punch=true; fighter.hit=true;
  setTimeout(()=>{fighter.punch=false; fighter.hit=false;},150);
}

canvas.addEventListener("touchstart", e=>{
  let x=e.touches[0].clientX;
  if(x<window.innerWidth/3) moveLeft=true;
  else if(x>window.innerWidth*2/3) moveRight=true;
  else punch(enemy,player,10), player.meter=Math.min(player.meter+10,60);
});
canvas.addEventListener("touchend",()=>{ moveLeft=false; moveRight=false; });

// --- Enemy AI ---
function enemyAI(){
  if(enemy.x>player.x+50) enemy.x-=1.5;
  if(enemy.x<player.x-50) enemy.x+=1.5;
  if(Math.abs(enemy.x-player.x)<60 && Math.random()<0.02) punch(player,enemy,8);
  enemy.x=Math.min(stageRight,Math.max(stageLeft,enemy.x));
}

// --- Game Loop ---
function gameLoop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawBackground();

  if(moveLeft) player.x=Math.max(stageLeft,player.x-3);
  if(moveRight) player.x=Math.min(stageRight,player.x+3);

  drawFighter(player,"prince");
  drawFighter(enemy,"tyson");
  drawUI();

  enemyAI();

  if(player.hp<=0||enemy.hp<=0){
    ctx.fillStyle="white"; ctx.font="32px Arial";
    ctx.fillText(player.hp>0?"YOU WIN!":"YOU LOSE!",canvas.width/2-90,canvas.height/2);
    return;
  }

  requestAnimationFrame(gameLoop);
}
gameLoop();

// --- Special Attack ---
document.getElementById("special").onclick=()=>{ if(player.meter>=60){ punch(enemy,player,30); player.meter=0;} }
</script>
</body>
</html>
