<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Clay Knockout: Prince vs Tyson</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#2b2b2b">
<link rel="manifest" href="manifest.json">
<style>
body { margin:0; background:#2b2b2b; touch-action:manipulation; font-family:Arial,sans-serif; }
canvas { display:block; margin:auto; background:radial-gradient(#444,#111); }
#ui { position:absolute; top:10px; width:100%; text-align:center; color:white; }
button { background:#c0392b; color:white; border:none; padding:10px 16px; border-radius:20px; font-size:16px; }
</style>
</head>
<body>
<div id="ui"><button id="special">SPECIAL</button></div>
<canvas id="game"></canvas>

<script>
// PWA support
if ("serviceWorker" in navigator) navigator.serviceWorker.register("sw.js");

// Canvas setup
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
function resizeCanvas(){ canvas.width=window.innerWidth; canvas.height=window.innerHeight; }
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

// Game state
let player={x:canvas.width*0.25,y:canvas.height*0.7,hp:100,meter:0,hit:false,punch:false};
let enemy={x:canvas.width*0.75,y:canvas.height*0.7,hp:100,hit:false,punch:false};
const stageLeft=50, stageRight=canvas.width-50;

// ----- Crowd & Ring -----
function drawBackground(){
  // Crowd silhouettes
  for(let i=0;i<canvas.width;i+=30){
    ctx.fillStyle=`rgba(0,0,0,${0.1+Math.random()*0.2})`;
    ctx.beginPath();
    ctx.arc(i,canvas.height*0.6+Math.random()*20,10,0,Math.PI*2);
    ctx.fill();
  }

  // Clay ring floor
  let ringGrad=ctx.createRadialGradient(canvas.width/2,canvas.height*0.7,50,canvas.width/2,canvas.height*0.7,canvas.width/2);
  ringGrad.addColorStop(0,"#7a5d3b");
  ringGrad.addColorStop(1,"#3e2f1c");
  ctx.fillStyle=ringGrad;
  ctx.beginPath();
  ctx.ellipse(canvas.width/2,canvas.height*0.7,canvas.width*0.4,100,0,0,Math.PI*2);
  ctx.fill();

  // Ring ropes
  ctx.strokeStyle="#d4af37";
  ctx.lineWidth=4;
  for(let j=0;j<3;j++){
    ctx.beginPath();
    ctx.ellipse(canvas.width/2,canvas.height*0.7-20+j*20,canvas.width*0.4,100,0,0,Math.PI*2);
    ctx.stroke();
  }
}

// ----- Clay Fighter Drawing -----
function drawFighter(f,char){
  ctx.save(); ctx.translate(f.x,f.y);

  // stop-motion jiggle
  let jig=[(Math.random()-0.5)*2,(Math.random()-0.5)*2]; ctx.translate(...jig);
  let scaleY=f.hit?1.2:1; ctx.scale(1,scaleY);

  function clayCircle(x,y,r,base,highlight){
    let grad=ctx.createRadialGradient(x,y-r/2,r/5,x,y,r*1.1);
    grad.addColorStop(0,highlight); grad.addColorStop(1,base);
    ctx.fillStyle=grad;
  }

  // Shadow under fighter
  let shadowGrad=ctx.createRadialGradient(0,35,5,0,35,20);
  shadowGrad.addColorStop(0,"rgba(0,0,0,0.4)");
  shadowGrad.addColorStop(1,"rgba(0,0,0,0)");
  ctx.fillStyle=shadowGrad;
  ctx.beginPath();
  ctx.ellipse(0,35,20,10,0,0,Math.PI*2); ctx.fill();

  if(char==="prince"){
    clayCircle(-10,30,12,"#6a0dad","#9b4ef7"); ctx.beginPath(); ctx.ellipse(-10,30,12,12,0,0,Math.PI*2); ctx.fill();
    clayCircle(10,30,12,"#6a0dad","#9b4ef7"); ctx.beginPath(); ctx.ellipse(10,30,12,12,0,0,Math.PI*2); ctx.fill();
    clayCircle(0,10,25,"#55228b","#8a5de9"); ctx.beginPath(); ctx.ellipse(0,10,25,30,0,0,Math.PI*2); ctx.fill();
    clayCircle(0,-20,18,"#f1c27d"
